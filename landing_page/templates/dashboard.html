{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h1>Bem-vindo, {{ session['user_email'] }}</h1>

<!-- Flash messages -->
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class="flashes">
      {% for msg in messages %}
        <li>{{ msg }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}

<!-- Formulário de upload -->
<section class="upload-section">
    <h2>Publicar Reels</h2>
    <form action="{{ url_for('upload_video') }}" method="POST" enctype="multipart/form-data">
        <label for="conta">Selecione a conta:</label>
        <select name="conta_id" required>
            {% for conta in contas %}
                <option value="{{ conta.id }}">{{ conta.username }}</option>
            {% endfor %}
        </select>

        <input type="file" name="video" accept="video/*" required>
        <textarea name="legenda" placeholder="Escreva a legenda..."></textarea>
        <input type="datetime-local" name="agendamento">
        <button type="submit">Publicar</button>
    </form>
</section>

<!-- Tabela de publicações -->
<section class="publicacoes-section">
    <h2>Publicações e Agendamentos</h2>
    <table>
        <thead>
            <tr>
                <th>Vídeo</th>
                <th>Legenda</th>
                <th>Data/Hora</th>
                <th>Conta</th>
                <th>Status</th>
                <th>Ação</th>
            </tr>
        </thead>
        <tbody>
            {% for pub in publicacoes %}
            <tr>
                <td>{{ pub['video'] }}</td>
                <td>{{ pub['legenda'] }}</td>
                <td>{{ pub['data_hora'] }}</td>
                <td>{{ pub['username'] }}</td>
                <td>{{ pub['status'] }}</td>
                <td>
                    {% if pub['status'] == 'agendado' %}
                    <form action="{{ url_for('cancel_agendamento', pub_id=pub['id']) }}" method="POST">
                        <button type="submit">Cancelar</button>
                    </form>
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>

<script>
flatpickr("input[name=agendamento]", {
    enableTime: true,
    dateFormat: "Y-m-d H:i",
    minDate: "today"
});
</script>
{% endblock %}
